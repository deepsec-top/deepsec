- ID: il-002
  Category: 信息泄露
  Created_At: 2025-05-29
  Contributors: 
    - [@wzfukui](https://github.com/wzfukui)
  Additional_Info: |
    - Web文件信息泄露，可能导致数据库连接参数、内部资产特性等信息曝光
  Title_CN: Web根目录文件遍历导致信息泄露，可下载/etc/passwd文件
  Title_EN: Web root directory information leakage, can download file conn.php
  Question: |
    - 组织背景：某公司官方网站有第三方服务团队维护，且部署在某公有云平台。外部服务人员定期登录系统进行相关的配置更新或者数据备份操作。
    - 事件描述：根据漏洞扫描器检测发现，用户服务器:8989端口开放，且根目录出现遍历漏洞，允许外部用户浏览当前目录所有文件并下载文件
    - 上下文：目前测试可下载的文件包括conn.php, index.php, utils/目录等。
    
    作为SOC团队的指挥官，请你对安全事件作出评估并决策。
  Complex_CoT: |
    1. 首先，扫描器发现了服务器存在信息泄露，这是一个确定的客观事实。
    2. 其次，而服务器之所以有信息泄露，是因为开放了Web端口（非网站标准端口，可能是临时的），且支持目录遍历。
    3. 通常的IT运维场景，运维人员有可能为了备份或者下载文件，临时启动一个HTTP Server服务（不规范操作），并在后期忘记关闭，可能导致该问题
    4. 也有可能是攻击者所启动的HTTP服务，需要深入核实。
    2. 建议立即采取以下措施：
      - 对目标服务器进行一次全端口扫描，尤其是外网角度的扫描，确认其开放端口是否符合安全基线要求
      - 登录服务器查看具体是哪个进程开放了8989端口，对该进程进行终止操作，防止扩散影响
      - 检查内网流量审计，确认是否有针对8989端口的其他HTTP请求，识别是否有敏感信息实质泄露
      - 整理所有访问过8989端口的IP地址，尤其是外网IP地址，进行综合研判
      - 分析服务器登录日志，分析为什么会启动Web服务，并确认是否符合运维管理规范
      - 对访问/下载过敏感文件的IP进行挖掘，是否还攻击过其他系统？

  Response: |
    已经收到了一个确定性的信息泄露事件，接下来准备启动事件处理：
    1. 启动对目标服务器的全亮端口扫描，扫描模板必须支持Banner识别
    2. 对conn.php文件进行分析，识别数据字段（注意，敏感信息脱敏）
    3. 通过流量审计或者服务器日志，检查服务器:8989端口的访问记录，确认是否有非内部人员访问过并下载文件
    4. 通过堡垒机、HIDS、EDR或云助手，执行命令，确认是哪个进程（以及父进程）启动的HTTP服务
    5. 获取服务器最近24小时内的所有登录和操作日志


    进一步决策（基于上述动作完成的结果）：
    1. 如果HTTP服务是Python这类临时工具启动的，则可以立即结束进程
    2. 如果HTTP服务是系统特定的Web服务启动的，则需要检查该服务对应的配置文件，必要时候人工修改配置然后重启服务
    3. 如果是生产环境，相关的修改/重启操作需要遵循操作规范
    4. 如果敏感信息已经泄露，需要联系数据库DBA重置密码
    5. 根据服务器的登录日志、操作日志甚至Web日志分析，确定端口是内部人员开放还是外部攻击者开放。
    6. 如果是外部攻击者开放，需要进一步分析，攻击者是如何启动的服务，做深入的渗透行为分析。